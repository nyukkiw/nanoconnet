import{s as e,a as r}from"./index-DrKg6622.js";const n={async getInfluencers(r={}){try{let n=e.from("influencers").select("\n          id,\n          user_id,\n          followers_count,\n          engagement_rate,\n          niche,\n          price_per_post,\n          currency,\n          bio_extended,\n          instagram_handle,\n          tiktok_handle,\n          youtube_channel,\n          rating,\n          total_reviews,\n          users (id, name, profile_image_url, location)\n        ");r.niche&&(n=n.eq("niche",r.niche)),r.minPrice&&r.maxPrice&&(n=n.gte("price_per_post",r.minPrice).lte("price_per_post",r.maxPrice)),r.location&&(n=n.eq("users.location",r.location)),r.minEngagement&&(n=n.gte("engagement_rate",r.minEngagement)),n=n.order("rating",{ascending:!1});const{data:t,error:a}=await n;if(a)throw a;return{data:t,error:null}}catch(n){return{data:null,error:n.message}}},async getInfluencerById(r){try{const{data:n,error:t}=await e.from("influencers").select("\n          id,\n          user_id,\n          followers_count,\n          engagement_rate,\n          niche,\n          price_per_post,\n          currency,\n          bio_extended,\n          instagram_handle,\n          tiktok_handle,\n          youtube_channel,\n          collaboration_rate,\n          response_time_hours,\n          previous_collaborations,\n          rating,\n          total_reviews,\n          users (id, name, profile_image_url, location, bio, phone)\n        ").eq("id",r).single();if(t)throw t;return{data:n,error:null}}catch(n){return{data:null,error:n.message}}},async searchInfluencers(r){try{const{data:n,error:t}=await e.from("influencers").select("\n          id,\n          niche,\n          price_per_post,\n          rating,\n          users (name, profile_image_url)\n        ").ilike("users.name",`%${r}%`).limit(10);if(t)throw t;return{data:n,error:null}}catch(n){return{data:null,error:n.message}}},async getInfluencerReviews(r){try{const{data:n,error:t}=await e.from("reviews").select("\n          id,\n          rating,\n          comment,\n          created_at,\n          users (name, profile_image_url)\n        ").eq("influencer_id",r).order("created_at",{ascending:!1});if(t)throw t;return{data:n,error:null}}catch(n){return{data:null,error:n.message}}},async getTopInfluencers(r=5){try{const{data:n,error:t}=await e.from("influencers").select("\n          id,\n          niche,\n          price_per_post,\n          rating,\n          users (name, profile_image_url, location)\n        ").order("rating",{ascending:!1}).limit(r);if(t)throw t;return{data:n,error:null}}catch(n){return{data:null,error:n.message}}}},t={async createBooking(r){try{const{data:n,error:t}=await e.from("bookings").insert([{sme_id:r.smeId,influencer_id:r.influencerId,campaign_name:r.campaignName,budget:r.budget,num_posts:r.numPosts,start_date:r.startDate,end_date:r.endDate,description:r.description,status:"pending"}]).select();if(t)throw t;return{data:null==n?void 0:n[0],error:null}}catch(n){return{data:null,error:n.message}}},async getUserBookings(r,n="sme"){try{const t="sme"===n?"sme_id":"influencer_id",{data:a,error:o}=await e.from("bookings").select(`\n          id,\n          campaign_name,\n          budget,\n          num_posts,\n          start_date,\n          end_date,\n          description,\n          status,\n          created_at,\n          ${"sme"===n?"influencers (id, niche, price_per_post, users(name, profile_image_url))":"smes (id, name, users(profile_image_url))"}\n        `).eq(t,r).order("created_at",{ascending:!1});if(o)throw o;return{data:a,error:null}}catch(t){return{data:null,error:t.message}}},async getBookingById(r){try{const{data:n,error:t}=await e.from("bookings").select("\n          id,\n          campaign_name,\n          budget,\n          num_posts,\n          start_date,\n          end_date,\n          description,\n          status,\n          created_at,\n          smes (id, name, users(name, profile_image_url, email)),\n          influencers (id, niche, price_per_post, users(name, profile_image_url, email))\n        ").eq("id",r).single();if(t)throw t;return{data:n,error:null}}catch(n){return{data:null,error:n.message}}},async updateBookingStatus(r,n){try{const{data:t,error:a}=await e.from("bookings").update({status:n,updated_at:new Date}).eq("id",r).select();if(a)throw a;return{data:null==t?void 0:t[0],error:null}}catch(t){return{data:null,error:t.message}}},async cancelBooking(r,n=""){try{const{data:t,error:a}=await e.from("bookings").update({status:"cancelled",cancellation_reason:n,updated_at:new Date}).eq("id",r).select();if(a)throw a;return{data:null==t?void 0:t[0],error:null}}catch(t){return{data:null,error:t.message}}}},a={async calculateMatchScore(r,n){var t;try{const{data:a,error:o}=await e.from("smes").select("budget, niche, target_audience, location").eq("id",r).single();if(o)throw o;const{data:i,error:s}=await e.from("influencers").select("price_per_post, niche, engagement_rate, rating, users(location)").eq("id",n).single();if(s)throw s;let c=0;const l={},u=40*Math.min(a.budget/i.price_per_post,1);c+=u,l.budget=u;const d=a.niche.toLowerCase()===i.niche.toLowerCase()?35:20;c+=d,l.niche=d;const m=15*Math.min(i.engagement_rate/10,1);c+=m,l.engagement=m;const g=a.location===(null==(t=i.users)?void 0:t.location)?10:5;return c+=g,l.location=g,{matchScore:Math.round(Math.min(c,100)),factors:l,error:null}}catch(a){return{matchScore:0,factors:{},error:a.message}}},async getRecommendations(r,n=5){try{const{data:t,error:a}=await e.from("smes").select("budget, niche, location").eq("id",r).single();if(a)throw a;const{data:o,error:i}=await e.from("influencers").select("\n          id,\n          niche,\n          price_per_post,\n          engagement_rate,\n          rating,\n          users(id, name, profile_image_url, location)\n        ").eq("niche",t.niche).order("rating",{ascending:!1}).limit(2*n);if(i)throw i;return{recommendations:(await Promise.all(o.map(async e=>{const{matchScore:n}=await this.calculateMatchScore(r,e.id);return{...e,matchScore:n}}))).sort((e,r)=>r.matchScore-e.matchScore).slice(0,n),error:null}}catch(t){return{recommendations:[],error:t.message}}},async saveMatchScore(r,n,t){try{const{error:a}=await e.from("matches").insert([{sme_id:r,influencer_id:n,score:t,calculated_at:new Date}]);if(a)throw a;return{error:null}}catch(a){return{error:a.message}}}},o={async getUserProfile(r){try{const{data:n,error:t}=await e.from("users").select("*").eq("id",r).single();if(t)throw t;return{data:n,error:null}}catch(n){return{data:null,error:n.message}}},async getInfluencerProfile(r){try{const{data:n,error:t}=await e.from("influencers").select("\n          *,\n          users(*)\n        ").eq("user_id",r).single();if(t)throw t;return{data:n,error:null}}catch(n){return{data:null,error:n.message}}},async getSMEProfile(r){try{const{data:n,error:t}=await e.from("smes").select("\n          *,\n          users(*)\n        ").eq("user_id",r).single();if(t)throw t;return{data:n,error:null}}catch(n){return{data:null,error:n.message}}},async updateUserProfile(r,n){try{const{data:t,error:a}=await e.from("users").update(n).eq("id",r).select();if(a)throw a;return{data:null==t?void 0:t[0],error:null}}catch(t){return{data:null,error:t.message}}},async updateInfluencerProfile(r,n){try{const{data:t,error:a}=await e.from("influencers").update(n).eq("user_id",r).select();if(a)throw a;return{data:null==t?void 0:t[0],error:null}}catch(t){return{data:null,error:t.message}}},async uploadProfileImage(r,n){try{const t=`${r}-profile.${n.name.split(".").pop()}`,{data:a,error:o}=await e.storage.from("profile-images").upload(t,n,{upsert:!0});if(o)throw o;const{data:{publicUrl:i}}=e.storage.from("profile-images").getPublicUrl(t);return await this.updateUserProfile(r,{profile_image_url:i}),{publicUrl:i,error:null}}catch(t){return{publicUrl:null,error:t.message}}}},i={auth:r,influencer:n,booking:t,matching:a,user:o};export{i as api,r as authService,t as bookingService,i as default,n as influencerService,a as matchingService,e as supabase,o as userService};
